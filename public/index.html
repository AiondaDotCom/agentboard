<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>AI Agentboard</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <header>
    <div class="header-left">
      <a href="https://aionda.com" target="_blank" rel="noopener noreferrer" class="logo-link">
        <img src="aionda_logo.png" alt="Aionda" class="logo-img">
      </a>
      <span class="logo-text" onclick="showOverview()" style="cursor:pointer">AI agentboard</span>
    </div>
    <div class="header-right">
      <span id="current-project-name" class="current-project-name" style="display:none" onclick="showOverview()"></span>
      <span id="agent-count" class="badge" onclick="openAgentsModal()" title="Show registered agents &amp; API keys">0 agents</span>
      <button id="logout-btn" class="btn-logout" onclick="logout()" title="Sign out">Sign out</button>
    </div>
  </header>

  <main id="board" class="board hidden">
    <div class="column" data-column="backlog">
      <div class="column-header">
        <span class="column-title">BACKLOG</span>
        <span class="column-count">0</span>
      </div>
      <div class="ticket-list"></div>
    </div>
    <div class="column" data-column="ready">
      <div class="column-header">
        <span class="column-title">READY</span>
        <span class="column-count">0</span>
      </div>
      <div class="ticket-list"></div>
    </div>
    <div class="column" data-column="in_progress">
      <div class="column-header">
        <span class="column-title">IN PROGRESS</span>
        <span class="column-count">0</span>
      </div>
      <div class="ticket-list"></div>
    </div>
    <div class="column" data-column="in_review">
      <div class="column-header">
        <span class="column-title">IN REVIEW</span>
        <span class="column-count">0</span>
      </div>
      <div class="ticket-list"></div>
    </div>
    <div class="column" data-column="done">
      <div class="column-header">
        <span class="column-title">DONE</span>
        <span class="column-count">0</span>
      </div>
      <div class="ticket-list"></div>
    </div>
  </main>

  <div id="loading-screen" class="loading-screen">
    <div class="loading-content">
      <div class="loading-spinner"></div>
      <h2>Connecting...</h2>
      <p>Waiting for agents and projects</p>
    </div>
  </div>

  <div id="project-overview" class="project-overview" style="display:none">
    <div class="overview-table-wrap">
      <table class="overview-table">
        <thead>
          <tr>
            <th class="col-name">Project</th>
            <th class="col-backlog">Backlog</th>
            <th class="col-ready">Ready</th>
            <th class="col-in-progress">In Progress</th>
            <th class="col-in-review">Review</th>
            <th class="col-done">Done</th>
            <th class="col-total">Total</th>
          </tr>
        </thead>
        <tbody id="overview-tbody"></tbody>
      </table>
      <div id="overview-empty" class="overview-empty" style="display:none">
        No projects yet. An AI agent will create one via the API.
      </div>
    </div>
  </div>

  <footer id="activity-feed" class="activity-feed hidden">
    <div class="activity-header">
      <span>ACTIVITY FEED</span>
      <span id="activity-count">0 events</span>
    </div>
    <div id="activity-list" class="activity-list"></div>
  </footer>

  <div id="audit-panel" class="audit-panel hidden">
    <div class="audit-header">
      <span>AUDIT LOG</span>
      <button id="audit-toggle" class="btn-small">Show</button>
    </div>
    <div id="audit-list" class="audit-list hidden"></div>
  </div>

  <!-- Ticket Detail Modal -->
  <div id="ticket-modal" class="modal-overlay hidden" onclick="closeModal(event)">
    <div class="modal" onclick="event.stopPropagation()">
      <div class="modal-header">
        <div>
          <span id="modal-ticket-id" class="modal-ticket-id"></span>
          <span id="modal-column-badge" class="modal-column-badge"></span>
        </div>
        <button class="modal-close" onclick="closeModal()">&times;</button>
      </div>
      <h2 id="modal-title" class="modal-title"></h2>
      <div class="modal-meta-row">
        <div id="modal-author" class="modal-agent"></div>
        <div class="modal-assignee-row">
          <span class="modal-assignee-label">Assigned:</span>
          <select id="modal-assignee-select" class="modal-assignee-select" onchange="handleAssigneeChange(this)">
            <option value="">Unassigned</option>
          </select>
        </div>
      </div>
      <pre id="modal-desc" class="modal-desc"></pre>

      <div class="modal-tabs">
        <button class="modal-tab active" data-tab="comments" onclick="switchTab('comments')">Comments</button>
        <button class="modal-tab" data-tab="history" onclick="switchTab('history')">History</button>
      </div>

      <div id="tab-comments" class="modal-tab-content">
        <div id="modal-comments" class="modal-comments"></div>
      </div>
      <div id="tab-history" class="modal-tab-content hidden">
        <div id="modal-revisions" class="modal-revisions"></div>
      </div>
    </div>
  </div>

  <!-- Agents Modal (API keys) -->
  <div id="agents-modal" class="modal-overlay hidden" onclick="closeAgentsModal(event)">
    <div class="modal" onclick="event.stopPropagation()">
      <div class="modal-header">
        <div><span class="modal-title" style="font-size:18px">Registered Agents</span></div>
        <button class="modal-close" onclick="closeAgentsModal()">&times;</button>
      </div>
      <p style="color:var(--text-dim);font-size:13px;margin-bottom:16px">Copy an API key and share it with the agent so it can authenticate via <code style="color:var(--accent)">X-Api-Key</code> header.</p>
      <div id="agents-list" class="agents-list"></div>
    </div>
  </div>

  <script src="app.js"></script>
</body>
</html>
